/****************************************Copyright (c)**************************************************
**                                  vixa
**
**--------------文件信息--------------------------------------------------------------------------------
**文   件   名: STM32_Function.c
**创   建   人: Xsky
**创 建 日  期: 2011-05-23 11:40
**描        述: STM32相关的功能函数
** 版  本: v1.0.00
**------------------------------------------------------------------------------------------------------
** 相关文件: 
**			 
**			 
**-------------------------------------------------------------------------------------------------------
**
**------------------------------------------------------------------------------------------------------
** 最后修改日期: 
** 修改人: Xsky
** 版本: v1.0.00
**-------------------------------------------------------------------------------------------------------
** 修改人: Xsky
** 日期: 
** 版本: v1.0.00
** 修改: 
**			1. 
**			2. 
**			3. 
**			4. 
**			5. 
********************************************************************************************************/

#define  STEM32_FUN_GLOBALS
#include "Global.h"
#include "stm32f10x.h"
#include "Stm32_Function.h"

/*********************************************************************************************************
** 函数名称: CRC_CalcBlockCRC
** 功能描述: 按字节计算CRC校验值
** 输　入:  1. pBuffer[]: 缓冲区
**			2. BufferLength: 要计数的数据长度
** 输　出: 无
** 返　回: 16位的CRC值,实际为CRC->DR 32位结果高16与低16位异或值
** 全局变量: 无
** 调用模块: 无
** 版　本: v1.0.00
** 作　者: Xsky
** 日　期: 2011-05-23 11:47
** 备　注: 
**-------------------------------------------------------------------------------------------------------
** 版　本: 
** 修改人: 
** 日　期: 
** 描　述: 
********************************************************************************************************/
uint16 CRC_CalcBlock(uint8 pBuffer[], uint32 BufferLength)
{
	register uint32 index;
	register uint32 u32R;
	
	/* Reset CRC generator */
	CRC->CR = CRC_CR_RESET;
	
	for(index = 0; index < BufferLength; index++)
	{
		CRC->DR = pBuffer[index];
	}
	
	u32R = CRC->DR;
	return (u32R) ^ (u32R >> 16);
}
	

